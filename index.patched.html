<!doctype html>
<html lang="es">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>Cuestionario Â· RecepciÃ³n</title>
<style>
:root{--bg:#f7f9fc;--card:#fff;--ink:#0f172a;--muted:#475569;--brand:#0b5faf;--brand2:#00b0ff;--shadow:0 10px 25px rgba(2,6,23,.08),0 3px 8px rgba(2,6,23,.05)}
*{box-sizing:border-box}
body{margin:0;background:var(--bg);color:var(--ink);font-family:ui-sans-serif,system-ui,-apple-system,Segoe UI,Roboto,Arial}
header{background:#fff;box-shadow:var(--shadow);padding:18px 16px;margin-bottom:18px}
.intro{max-width:1100px;margin:0 auto;display:flex;align-items:center;gap:16px}
.intro img{height:56px;margin-right:10px}
.intro h1{margin:0 0 6px;font-size:28px;color:#004f6e}
.gold{height:8px;background:linear-gradient(90deg,#c08a2e,#f0c24b,#00b0ff);border-radius:6px;margin-top:12px}

.container{max-width:1100px;margin:0 auto;padding:0 16px 30px}
.grid{display:grid;grid-template-columns:320px 1fr;gap:20px}
@media(max-width:980px){.grid{grid-template-columns:1fr}}
.card{background:#fff;border-radius:18px;box-shadow:var(--shadow)}
.panel{padding:18px}
.muted{color:#475569}

/* Nivel pill */
.pill{display:inline-flex;align-items:center;gap:8px;border-radius:999px;padding:6px 10px;font-size:12px}
.pill.basico{background:#e8fff1;color:#14532d}
.pill.intermedio{background:#eef2ff;color:#1e3a8a}
.pill.avanzado{background:#fff1f2;color:#7f1d1d}

/* Inputs */
input,select{width:100%;padding:10px 12px;border:1px solid #e5e7eb;border-radius:12px;background:#fff;font-size:15px}
button{border:0;border-radius:12px;padding:10px 14px;font-weight:700;background:#0b5faf;color:#fff;box-shadow:var(--shadow);cursor:pointer}
button.secondary{background:#e5e7eb;color:#111827;box-shadow:none}
button.ghost{background:transparent;color:#0b5faf;box-shadow:none}

/* Progreso */
.progress{height:10px;background:#e5e7eb;border-radius:999px;overflow:hidden;margin:6px 0 12px}
.bar{height:100%;width:0;background:linear-gradient(90deg,var(--brand),var(--brand2));transition:width .25s}

/* Pregunta + respuestas alineadas izquierda */
.question{font-size:20px;font-weight:800;margin:0 0 10px}
.answers{display:grid;gap:10px}
.answer{
  display:grid; grid-template-columns:22px 28px 1fr; align-items:center;
  gap:12px; border:1px solid #e5e7eb; border-radius:14px; padding:12px;
  background:#fff; cursor:pointer; text-align:left;
}
.answer input{width:18px;height:18px;margin:0}
.letter{min-width:28px;height:24px;display:inline-flex;align-items:center;justify-content:center;font-weight:700;border-radius:999px;background:#e2e8f0;font-size:12px}
.answer.correct{border-color:#16a34a;background:#f0fdf4}
.answer.incorrect{border-color:#fecaca;background:#fff}
.answer.correct .letter{background:#bbf7d0}

/* ExplicaciÃ³n (siempre) */
.explain{margin-top:10px;padding:12px;border-radius:12px;display:none;border:1px dashed currentColor;background:#fff}
.explain.ok{color:#166534;background:#f0fdf4;border-color:#86efac}
.explain.bad{color:#991b1b;background:#fef2f2;border-color:#fecaca}
.explain small{display:block;color:#334155;opacity:.95;margin-top:6px}

/* Tablas */
table{width:100%;border-collapse:collapse}
th,td{padding:10px 8px;border-bottom:1px solid #eef2f7;text-align:left;font-size:14px}
th{font-weight:700;color:#334155}

/* Meta */
.qmeta{display:flex;align-items:center;gap:8px;margin:0 0 6px}
.qid{font:12px/1 ui-monospace,Consolas,Menlo;background:#eef2ff;color:#3730a3;padding:3px 7px;border-radius:8px;border:1px solid #c7d2fe}

/* Cuadro de resultado final â€“ bonito */
.finalmsg{
  margin-top:20px;padding:20px;border-radius:16px;border:1px solid #e5e7eb;background:#fff;
  font-size:16px;line-height:1.5;box-shadow:0 4px 15px rgba(0,0,0,.05);transition:all .3s ease
}
.finalmsg h4{margin:0 0 6px;font-size:18px;font-weight:700}
.finalmsg p{margin:0}
.finalmsg.ok{background:linear-gradient(135deg,#f0fdf4,#dcfce7);border-color:#86efac;color:#14532d}
.finalmsg.ok h4::before{content:"ðŸŒŸ "}
.finalmsg.warn{background:linear-gradient(135deg,#fffbe6,#fef9c3);border-color:#fde68a;color:#78350f}
.finalmsg.warn h4::before{content:"ðŸ’ª "}
.finalmsg.bad{background:linear-gradient(135deg,#fef2f2,#fee2e2);border-color:#fecaca;color:#7f1d1d}
.finalmsg.bad h4::before{content:"â¤ï¸â€ðŸ”¥ "}
</style>
</head>
<body>
<header>
  <div class="intro">
    <div>
      <img src="img/logo_guadiana.png" alt="Hotel Sercotel Guadiana">
      <img src="img/logo_cumbria.png" alt="Cumbria Spa & Hotel">
    </div>
    <div>
      <h1>Cuestionario Â· RecepciÃ³n</h1>
      <p class="muted"><em>FormaciÃ³n interna para RecepciÃ³n y Calidad</em></p>
      <div class="gold"></div>
    </div>
  </div>
</header>

<div class="container">

  <!-- PORTADA (solo al inicio) -->
  <section class="card panel" id="introBlock" style="margin-bottom:18px">
    <h3 style="margin:0 0 8px">Â¿Por quÃ© realizamos estas pruebas?</h3>
    <p><b>Sercotel Guadiana y Cumbria Spa&Hotel</b></p>
    <p>Estas pruebas no son un examen para â€œaprobar o suspenderâ€, sino una herramienta para crecer juntos.</p>
    <div style="display:grid;grid-template-columns:24px 1fr;gap:8px;align-items:start">
      <div>ðŸ”</div>
      <div>
        <p style="margin:.2rem 0"><b>Â¿QuÃ© buscamos?</b></p>
        <ul style="margin:.3rem 0 .8rem">
          <li><b>Refuerzo del conocimiento clave</b>: atenciÃ³n al huÃ©sped, uso del PMS, seguridad, etc.</li>
          <li><b>EstÃ¡ndares comunes</b> entre Guadiana y Cumbria, sea cual sea el turno.</li>
          <li><b>DetecciÃ³n de mejoras</b>: formaciÃ³n y apoyo donde haga falta.</li>
          <li><b>Reconocer buenas prÃ¡cticas</b> que elevan la experiencia del huÃ©sped.</li>
          <li><b>Cultura de excelencia</b>: la excelencia es un hÃ¡bito y cada detalle cuenta.</li>
        </ul>
        <div style="padding:10px;border:1px dashed #cbd5e1;border-radius:12px;background:#f8fafc">
          <b>Mensaje al equipo:</b> â€œNo se trata de memorizar: recordamos por quÃ© lo hacemos
          y cÃ³mo impacta en nuestros huÃ©spedes. Â¡Gracias por vuestro compromiso!â€
        </div>
      </div>
    </div>
  </section>

  <div class="grid">
    <aside class="card panel">
      <h3 style="margin:0 0 8px">1) IdentificaciÃ³n</h3>
      <p class="muted">Tu nombre es obligatorio para participar y aparecer en el ranking.</p>
      <input id="playerName" placeholder="Nombre y apellidos (obligatorio)">
      <hr style="border:0;border-top:1px solid #e5e7eb;margin:14px 0">

      <h3 style="margin:0 0 8px">2) MÃ³dulo y nivel</h3>
      <select id="moduleSelect"><option value="">Selecciona mÃ³duloâ€¦</option></select>
      <div style="height:8px"></div>
      <select id="levelSelect">
        <option value="basico">Nivel BÃ¡sico ðŸŸ¢</option>
        <option value="intermedio">Nivel Intermedio ðŸ”¹</option>
        <option value="avanzado">Nivel Avanzado ðŸ”´</option>
      </select>
      <div style="display:flex;gap:8px;margin-top:12px"><button id="startBtn">Comenzar</button></div>
      <div id="status" class="muted" style="margin-top:8px;display:none"></div>

      <hr style="border:0;border-top:1px solid #e5e7eb;margin:14px 0">
      <h3>ðŸ† Ranking</h3>
      <table><thead><tr><th>#</th><th>Nombre</th><th>MÃ³dulo</th><th>Punt.</th><th>Fecha</th></tr></thead><tbody id="lbBody"><tr><td colspan="5" class="muted">Sin resultados todavÃ­a.</td></tr></tbody></table>

      <hr style="border:0;border-top:1px solid #e5e7eb;margin:14px 0">
      <h3>ðŸ“ˆ Resumen (automÃ¡tico)</h3>
      <table><thead><tr><th>#</th><th>Nombre</th><th>MÃ³dulo</th><th>Punt.</th><th>Fecha</th></tr></thead><tbody id="resumeBody"><tr><td colspan="5" class="muted">Sin participaciones aÃºn.</td></tr></tbody></table>
      <div style="margin-top:10px"><button id="exportBtn" class="ghost">Descargar Excel (CSV)</button></div>
    </aside>

    <main class="card panel">
      <div class="pill basico" id="levelPill">Nivel BÃ¡sico ðŸŸ¢</div>
      <div class="progress"><div class="bar" id="bar"></div></div>
      <div class="muted" id="tally">0/0 Â· 0 aciertos Â· 0 fallos Â· 0%</div>
      <hr style="border:0;border-top:1px solid #e5e7eb;margin:10px 0">

      <div id="live" style="display:none">
        <div class="qmeta"><span class="qid" id="qId">#â€”</span></div>
        <div class="question" id="qText">â€¦</div>
        <div class="answers" id="answers"></div>
        <div class="explain" id="why"></div>
        <div id="finalMsg" class="finalmsg" style="display:none"></div>
        <div style="display:flex;gap:8px;margin-top:12px">
          <button id="next" class="secondary" onclick="nextQ()" disabled>Siguiente</button>
          <button id="finish" class="ghost" onclick="finish()" style="display:none">Finalizar</button>
        </div>
      </div>
    </main>
  </div>
</div>

<!-- âš ï¸ v=3 para forzar recarga sin cachÃ© -->

<!-- PATCH: helper script to fix data path, header text, department select and remove duplicate ranking -->
<script>
  // === Config editable ===
  const CABECERA_TITULO = "FormaciÃ³n Â· Excelencia en el Servicio"; // <- cambia aquÃ­ el texto de cabecera
  const DATA_INDEX_PATH = "./data/index.json"; // ruta relativa segura para file:/// y http(s)://

  // === 1) Fix fetch('/data/...') => './data/...' para evitar CORS al abrir con doble clic ===
  (function(){
    const origFetch = window.fetch;
    window.fetch = function(resource, init){
      try{
        if (typeof resource === "string" && resource.startsWith("/data/")) {
          resource = "./" + resource.replace(/^\//,"");
        }
      }catch(e){}
      return origFetch(resource, init);
    };
  })();

  // === 2) Ajuste de cabecera (cambia el H1 principal si existe) ===
  document.addEventListener("DOMContentLoaded", () => {
    const h1 = document.querySelector("h1, .post-header h1, header h1");
    if (h1 && CABECERA_TITULO) h1.textContent = CABECERA_TITULO;

    // === 3) Eliminar bloque duplicado de Ranking/Resumen si existe un segundo ranking ===
    // Buscamos un H3 con texto 'Resumen (automÃ¡tico)' y removemos su contenedor mÃ¡s cercano (card/panel/section)
    const headings = Array.from(document.querySelectorAll("h3"));
    const resumen = headings.find(h => /Resumen \(automÃ¡tico\)/i.test(h.textContent || ""));
    if (resumen) {
      let n = resumen;
      while (n && n.parentElement && !/card|panel|section|aside/i.test(n.className||"")) n = n.parentElement;
      (n || resumen).remove();
    }

    // === 4) Insertar selector de Departamento bajo el bloque de MÃ³dulo/Nivel ===
    // Buscamos el primer select del mÃ³dulo para ubicar el depto a continuaciÃ³n
    const moduleSelect = document.querySelector("select");
    if (moduleSelect) {
      const wrapper = document.createElement("div");
      wrapper.style.marginTop = "10px";
      wrapper.innerHTML = `
        <label for="deptSelect" style="display:block;font-weight:600;margin:10px 0 6px">Departamento</label>
        <select id="deptSelect" class="input" style="width:100%">
          <option value="">Todos los departamentos</option>
        </select>`;
      moduleSelect.parentElement.insertAdjacentElement("afterend", wrapper);

      // Cargar departamentos desde index.json (ruta segura)
      fetch(DATA_INDEX_PATH).then(r=>r.json()).then(idx => {
        const depts = idx.departments || idx.Departments || [];
        const sel = document.getElementById("deptSelect");
        if (sel && Array.isArray(depts)) {
          sel.innerHTML = '<option value="">Todos los departamentos</option>' +
            depts.map(d => `<option value="${d}">${d}</option>`).join("");
        }
        // Exponer filtro global para que lo use quiz.js si quiere
        sel && sel.addEventListener("change", () => {
          window.__QUIZ_SELECTED_DTO__ = sel.value || "";
        });
      }).catch(err => {
        console.warn("No se pudo leer departamentos:", err);
      });
    }
  });
</script>
<!-- /PATCH -->
<script src="js/loader.js?v=3"></script>
<script src="js/quiz.js?v=3"></script>
</body>
</html>
